(()=>{(function(){"use strict";var m=function(){var t=this,r=t.$createElement,e=t._self._c||r;return e("div",{staticClass:"k-block-type-form",on:{click:t.open}},[e("div",{staticClass:"k-block-type-form-wrapper",attrs:{"data-state":t.state}},[e("k-input",{attrs:{name:"name",type:"text"},on:{input:t.onInput},model:{value:t.content.name,callback:function(i){t.$set(t.content,"name",i)},expression:"content.name"}}),e("k-tag",{attrs:{"data-state":t.state}},[t._v(t._s(t.$t("form.block.inbox.show"))+" ("+t._s(this.stateText)+")")])],1)])},v=[],E="";function c(t,r,e,i,s,l,p,T){var n=typeof t=="function"?t.options:t;r&&(n.render=r,n.staticRenderFns=e,n._compiled=!0),i&&(n.functional=!0),l&&(n._scopeId="data-v-"+l);var a;if(p?(a=function(o){o=o||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,!o&&typeof __VUE_SSR_CONTEXT__!="undefined"&&(o=__VUE_SSR_CONTEXT__),s&&s.call(this,o),o&&o._registeredComponents&&o._registeredComponents.add(p)},n._ssrRegister=a):s&&(a=T?function(){s.call(this,(n.functional?this.parent:this).$root.$options.shadowRoot)}:s),a)if(n.functional){n._injectStyles=a;var V=n.render;n.render=function(F,_){return a.call(_),V(F,_)}}else{var h=n.beforeCreate;n.beforeCreate=h?[].concat(h,a):[a]}return{exports:t,options:n}}const $={data(){return{total:"-",new:"-",error:0}},created(){var r,e,i,s;setTimeout(this.open,500);const t=(s=(i=(e=(r=this==null?void 0:this.fieldset)==null?void 0:r.tabs)==null?void 0:e.inbox)==null?void 0:i.fields)!=null?s:{};Object.keys(t).forEach(l=>{t[l].parent=this.$attrs.id}),this.updateCount(),this.$events.$on("form.update",this.updateCount)},destroyed(){this.$events.$off("form.update",this.updateCount)},computed:{state(){return this.error>0?"error":this.total=="-"?"wait":this.new>0&&this.total>0?"new":"ok"},stateText(){if(typeof this.error=="string")return this.error;if(this.total=="-")return this.$t("loading")+"...";let t=this.new+"/"+this.total+" "+this.$t("form.block.inbox.unread");return this.error>0?t+" & "+this.error+" "+this.$t("form.block.inbox.failed"):t}},methods:{updateCount(){const t=this;this.$api.get("form/get-requests-count",{form:this.$attrs.id}).then(function(r){t.total=r[0],t.new=r[1],t.error=r[2]}).catch(function(){t.error=t.$t("form.block.inbox.error")})},onInput(t){this.$emit("update",t)}}},u={};var k=c($,m,v,!1,b,null,null,null);function b(t){for(let r in u)this[r]=u[r]}var g=function(){return k.exports}(),C=function(){var t=this,r=t.$createElement,e=t._self._c||r;return e("k-select-field",{attrs:{value:t.value,options:t.selectOptions,required:t.required,label:t.label,help:t.help},on:{input:t.onInput}})},y=[];const x={created(){this.findOptions(this)},data(){return{listItems:[]}},computed:{selectOptions(){var t;return this.listItems?(t=this.listItems)==null?void 0:t.map(r=>{var e,i;return{text:(e=r==null?void 0:r.label)!=null?e:"error",value:(i=r==null?void 0:r.slug)!=null?i:"error"}}):[]}},props:{help:String,label:String,required:Boolean,value:String},methods:{findOptions(t){var e,i;if(!t)throw this.$t("form.block.inbox.notinblock");let r=(i=(e=t==null?void 0:t.value)==null?void 0:e.options)!=null?i:!1;if(r){this.listItems=r;return}this.findOptions(t.$parent)},onInput(t){this.$emit("input",t)}}},d={};var w=c(x,C,y,!1,M,null,null,null);function M(t){for(let r in d)this[r]=d[r]}var S=function(){return w.exports}(),R=function(){var t=this,r=t.$createElement,e=t._self._c||r;return e("k-view",{staticClass:"k-field-type-mail-view"},[e("k-items",[t._l(t.list,function(i){return e("k-item",{key:i.id,staticClass:"k-field-type-mail-list-item",attrs:{options:[i.read==""?{icon:"preview",text:t.$t("form.block.inbox.asread"),click:function(){return t.setRead(!0,i)}}:{icon:"unread",text:t.$t("form.block.inbox.asunread"),click:function(){return t.setRead(!1,i)}},{icon:"trash",text:t.$t("form.block.inbox.delete"),click:function(){return t.deleteMail(i)}}]},on:{click:function(s){return t.openMail(i)},action:t.action}},[e("k-status-icon",{attrs:{status:i.status,tooltip:i.tooltip}}),e("header",{staticClass:"k-item-content"},[t._t("default",function(){return[e("h3",{staticClass:"k-item-title"},[t._v(t._s(i.title))]),e("p",{staticClass:"k-item-info",domProps:{innerHTML:t._s(i.desc)}})]})],2)],1)}),t.list.length==0?e("k-item",{staticClass:"k-field-type-page-list-item-empty",attrs:{text:t.$t("form.block.inbox.empty"),disabled:"true"}}):t._e()],2),e("k-text",{staticClass:"k-field-type-page-change-display"},[t.displayShown?t._e():e("a",{on:{click:function(i){return t.displaySet(!0)}}},[t._v(t._s(t.$t("form.block.inbox.changedisplay")))]),t.displayShown?e("a",{on:{click:function(i){return t.displaySet(!1)}}},[t._v(t._s(t.$t("close")))]):t._e()]),t.displayShown?e("div",[e("k-text-field",{attrs:{label:t.$t("form.block.inbox.display")},on:{input:function(i){return t.$emit("input",i)}},model:{value:t.value,callback:function(i){t.value=i},expression:"value"}})],1):t._e(),e("k-dialog",{ref:"dialog",staticClass:"k-field-type-page-dialog",attrs:{size:"medium"}},[e("k-headline",[t._v(t._s(t.current.title))]),e("div",{staticClass:"k-field-type-page-dialog-table",domProps:{innerHTML:t._s(t.current.summary)}}),t.current.length>0?e("k-fieldset",{attrs:{disabled:"true",fields:t.prev},model:{value:t.current,callback:function(i){t.current=i},expression:"current"}}):t._e(),t.current.error?e("k-info-field",{attrs:{text:t.current.error,theme:"negative"}}):t._e(),e("template",{slot:"footer"},[e("k-button-group",[t.current.read!=""?e("k-button",{on:{click:function(i){return t.setRead(!1)}}},[t._v(t._s(t.$t("form.block.inbox.asunread")))]):t._e(),e("k-button",{attrs:{icon:"times"},on:{click:function(i){return t.$refs.dialog.close()}}},[t._v(t._s(t.$t("close")))]),t.current.read==""?e("k-button",{on:{click:function(i){return t.setRead(!0)}}},[t._v(t._s(t.$t("form.block.inbox.asread")))]):t._e()],1)],1)],2)],1)},L=[],j="";const O={created(){this.findId(this.$parent)},data(){return{new:[],read:[],data:[],current:[],displayShown:!1,id:0,parent:0}},props:{value:String},computed:{prev(){return this.previewfields},list(){let t=[];for(let[r,e]of Object.entries(this.data)){e.id=r.split("/").at(-1),e.summary=JSON.parse(e.formdata).summary,e.status=this.getStatus(e),e.tooltip=this.getTooltip(e);let i=this.$library.dayjs(e.received,"YYYY-MM-DD HH:mm:ss");e.desc=i.isValid()?i:"",e.title=this.getLabel(e),t.push(e)}return t}},methods:{findId(t){var r,e,i,s;if(!t)throw this.$t("form.block.inbox.notinblock");if(this.parent=(s=(i=(e=(r=t.$parent)==null?void 0:r.$options)==null?void 0:e.propsData)==null?void 0:i.id)!=null?s:!1){this.$api.get("form/get-requests",{form:this.parent}).then(l=>this.data=l);return}this.findId(t.$parent)},getLabel(t){return this.value==""?t.id:this.$helper.string.template(this.value,JSON.parse(t.formdata))},getStatus(t){return t.read?"unlisted":t.error?"draft":"listed"},getTooltip(t){return t.error!=""?t.error:t.read!=""?this.$t("form.block.inbox.tooltip.read"):this.$t("form.block.inbox.tooltip.unread")},setRead(t,r=!1){r||(r=this.current);let e={form:this.parent,request:r.id,state:t};this.$api.get("form/set-read",e).then(i=>{this.data=i,this.$refs.dialog.close(),this.$events.$emit("form.update")})},openMail(t){this.current=t,this.$refs.dialog.open()},deleteMail(t){this.$api.get("form/delete-request",{form:this.parent,request:t.id}).then(r=>{this.data=r})},displaySet(t){this.displayShown=t,this.$events.$emit("form.update")}}},f={};var z=c(O,R,L,!1,H,null,null,null);function H(t){for(let r in f)this[r]=f[r]}var I=function(){return z.exports}();window.panel.plugin("microman/form-blocks",{fields:{mailview:I,selectoption:S},blocks:{form:g},icons:{form:'<path d="M6.9,13.6H2.2c-0.6,0-1.1-0.5-1.1-1.1V3.1C1.1,2.5,1.6,2,2.2,2h8.4c0.6,0,1.1,0.5,1.1,1.1v5.8 c0,0.3,0.2,0.5,0.5,0.5s0.5-0.2,0.5-0.5V3.1c0-1.2-0.9-2.1-2.1-2.1H2.2C1,1,0.1,1.9,0.1,3.1v9.5c0,1.2,0.9,2.1,2.1,2.1h4.7 c0.3,0,0.5-0.2,0.5-0.5C7.5,13.8,7.2,13.6,6.9,13.6z M9,4.1H3.8c-0.3,0-0.5,0.2-0.5,0.5c0,0.3,0.2,0.5,0.5,0.5H9 c0.3,0,0.5-0.2,0.5-0.5C9.6,4.4,9.3,4.1,9,4.1z M9.6,7.8c0-0.3-0.2-0.5-0.5-0.5H3.8c-0.3,0-0.5,0.2-0.5,0.5c0,0.3,0.2,0.5,0.5,0.5H9 C9.3,8.3,9.6,8.1,9.6,7.8z M3.8,10.4c-0.3,0-0.5,0.2-0.5,0.5c0,0.3,0.2,0.5,0.5,0.5h2.1c0.3,0,0.5-0.2,0.5-0.5 c0-0.3-0.2-0.5-0.5-0.5H3.8z M15.8,9.5c-0.2-0.2-0.5-0.2-0.7,0l-3.9,3.9l-1.8-1.8c-0.2-0.2-0.5-0.2-0.7,0c-0.2,0.2-0.2,0.5,0,0.7 l2,2c0,0.1,0.1,0.1,0.1,0.1c0.2,0.2,0.5,0.2,0.7,0l4.3-4.3C16,10,16,9.7,15.8,9.5z"/>',send:'<path d="M15.8,0.7C15.8,0.7,15.8,0.7,15.8,0.7C15.8,0.7,15.8,0.6,15.8,0.7c0-0.1,0-0.1,0-0.1c0,0,0-0.1,0-0.1c0,0,0,0,0,0 c0,0,0,0,0-0.1c0,0,0,0,0,0c0,0,0-0.1-0.1-0.1c0,0,0,0-0.1-0.1c0,0,0,0,0,0c0,0,0,0-0.1,0c0,0,0,0,0,0c0,0-0.1,0-0.1,0c0,0,0,0,0,0 c0,0,0,0-0.1,0c0,0,0,0,0,0c0,0,0,0-0.1,0c0,0,0,0,0,0c0,0-0.1,0-0.1,0L0.5,5.7C0.3,5.8,0.2,5.9,0.2,6.2c0,0.2,0.1,0.4,0.3,0.5 l6,2.9l2.9,6c0.1,0.2,0.3,0.3,0.5,0.3c0,0,0,0,0,0c0.2,0,0.4-0.1,0.5-0.3l5.5-14.6C15.8,0.8,15.8,0.8,15.8,0.7 C15.8,0.8,15.8,0.8,15.8,0.7C15.8,0.8,15.8,0.7,15.8,0.7z M13.2,2L6.7,8.5L2,6.2L13.2,2z M9.8,14L7.5,9.3L14,2.8L9.8,14z"/>',unread:'<path d="M15.72,8.44c0-0.26-0.11-0.52-0.3-0.71c-0.37-0.37-1.04-0.37-1.41,0c-0.08,0.08-0.13,0.18-0.18,0.28L13.82,8 c-0.78,1.17-2.98,4-5.82,4c-2.83,0-5.02-2.82-5.81-3.99c-0.01,0-0.01,0-0.02,0c-0.05-0.1-0.11-0.2-0.19-0.28 c-0.37-0.37-1.04-0.37-1.41,0C0.38,7.92,0.28,8.18,0.28,8.44c0,0.27,0.1,0.52,0.29,0.71c0,0.01-0.01,0.01-0.01,0.02 C1.55,10.64,4.23,14,8,14c3.92,0,6.68-3.66,7.56-5.01l-0.02-0.01C15.65,8.82,15.72,8.64,15.72,8.44z"/>'}})})();})();
